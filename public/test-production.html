<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Setup Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #005a9e;
        }
        .success-button {
            background: #28a745;
        }
        .success-button:hover {
            background: #218838;
        }
        .danger-button {
            background: #dc3545;
        }
        .danger-button:hover {
            background: #c82333;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            background: #fafafa;
        }
        .step {
            margin: 15px 0;
            padding: 15px;
            border-left: 4px solid #007acc;
            background: #f8f9fa;
        }
        .step h4 {
            margin: 0 0 10px 0;
            color: #007acc;
        }
        .code {
            background: #f4f4f4;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            margin: 10px 0;
        }
        .checklist {
            background: #e8f5e8;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .checklist ul {
            margin: 0;
            padding-left: 20px;
        }
        .checklist li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Production Setup Test</h1>

        <div class="info">
            <strong>üéØ Purpose:</strong> Test your production-ready database and authentication setup.
        </div>

        <div id="status"></div>

        <div class="section">
            <h3>üîç Step 1: Test Database Connection</h3>
            <button onclick="testDatabase()" class="success-button">Test Database Connection</button>
            <div id="dbTestResult"></div>
        </div>

        <div class="section">
            <h3>üîê Step 2: Test Authentication</h3>
            <button onclick="testAuth()" class="success-button">Test Authentication</button>
            <div id="authTestResult"></div>
        </div>

        <div class="section">
            <h3>üìä Step 3: Test Profile Operations</h3>
            <button onclick="testProfile()" class="success-button">Test Profile Operations</button>
            <div id="profileTestResult"></div>
        </div>

        <div class="section">
            <h3>üéâ Step 4: Complete Test</h3>
            <button onclick="runFullTest()" class="success-button">Run Complete Test</button>
            <div id="fullTestResult"></div>
        </div>

        <div class="section">
            <h3>üìã Test Results</h3>
            <div id="testSummary"></div>
        </div>

        <div class="section">
            <h3>üîß Troubleshooting</h3>
            <div id="troubleshooting"></div>
        </div>

        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
            <h3>‚úÖ Expected Results:</h3>
            <ul>
                <li>‚úÖ Database connection: Active</li>
                <li>‚úÖ Authentication: Working</li>
                <li>‚úÖ Profile operations: Functional</li>
                <li>‚úÖ Data persistence: Working</li>
            </ul>
        </div>
    </div>

    <script>
        let testResults = {
            database: false,
            auth: false,
            profile: false
        };

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = type;
            statusDiv.innerHTML = `<strong>${message}</strong>`;
        }

        function updateTestSummary() {
            const summaryDiv = document.getElementById('testSummary');
            const passed = Object.values(testResults).filter(Boolean).length;
            const total = Object.keys(testResults).length;

            let html = `<h4>Test Summary: ${passed}/${total} Passed</h4>`;
            html += '<ul>';

            Object.entries(testResults).forEach(([test, passed]) => {
                const status = passed ? '‚úÖ' : '‚ùå';
                const statusText = passed ? 'PASSED' : 'FAILED';
                html += `<li><strong>${test.charAt(0).toUpperCase() + test.slice(1)}:</strong> ${status} ${statusText}</li>`;
            });

            html += '</ul>';

            if (passed === total) {
                html += '<div class="success">üéâ All tests passed! Your production setup is working correctly.</div>';
            } else {
                html += '<div class="warning">‚ö†Ô∏è Some tests failed. Check the troubleshooting section below.</div>';
            }

            summaryDiv.innerHTML = html;
        }

        async function testDatabase() {
            showStatus('Testing database connection...', 'info');
            document.getElementById('dbTestResult').innerHTML = '';

            try {
                const response = await fetch('/api/users?test=1');
                const data = await response.json();

                if (response.ok && data.database === 'connected') {
                    document.getElementById('dbTestResult').innerHTML =
                        `<div class="success">‚úÖ Database Connection: SUCCESS</div>
                         <p><strong>Status:</strong> ${data.database}</p>
                         <p><strong>Message:</strong> ${data.message}</p>
                         <p><strong>Timestamp:</strong> ${data.timestamp}</p>`;
                    testResults.database = true;
                    showStatus('Database test passed', 'success');
                } else {
                    document.getElementById('dbTestResult').innerHTML =
                        `<div class="error">‚ùå Database Connection: FAILED</div>
                         <p><strong>Status:</strong> ${data.database || 'unknown'}</p>
                         <p><strong>Error:</strong> ${data.message || 'Connection failed'}</p>
                         <p><strong>Solution:</strong> Check your Neon database status and connection string.</p>`;
                    testResults.database = false;
                    showStatus('Database test failed', 'error');
                }
            } catch (error) {
                document.getElementById('dbTestResult').innerHTML =
                    `<div class="error">‚ùå Database Connection: ERROR</div>
                     <p><strong>Error:</strong> ${error.message}</p>
                     <p><strong>Solution:</strong> Check your internet connection and server status.</p>`;
                testResults.database = false;
                showStatus('Database test error', 'error');
            }

            updateTestSummary();
        }

        async function testAuth() {
            showStatus('Testing authentication...', 'info');
            document.getElementById('authTestResult').innerHTML = '';

            // Check if Firebase is configured
            const firebaseConfig = {
                apiKey: "AIzaSyB164AO9UUl8tI-QwOMMdKWY59hieEsXV8",
                authDomain: "carspian-seller.firebaseapp.com",
                projectId: "carspian-seller"
            };

            if (firebaseConfig.apiKey && firebaseConfig.authDomain && firebaseConfig.projectId) {
                document.getElementById('authTestResult').innerHTML =
                    `<div class="success">‚úÖ Authentication: CONFIGURED</div>
                     <p><strong>Firebase Project:</strong> ${firebaseConfig.projectId}</p>
                     <p><strong>Auth Domain:</strong> ${firebaseConfig.authDomain}</p>
                     <p><strong>Status:</strong> Ready for real authentication</p>
                     <p><strong>Note:</strong> Mock authentication disabled - using real Firebase Auth</p>`;
                testResults.auth = true;
                showStatus('Authentication test passed', 'success');
            } else {
                document.getElementById('authTestResult').innerHTML =
                    `<div class="error">‚ùå Authentication: NOT CONFIGURED</div>
                     <p><strong>Issue:</strong> Firebase configuration missing or incomplete</p>
                     <p><strong>Solution:</strong> Check your environment variables and Firebase setup.</p>`;
                testResults.auth = false;
                showStatus('Authentication test failed', 'error');
            }

            updateTestSummary();
        }

        async function testProfile() {
            showStatus('Testing profile operations...', 'info');
            document.getElementById('profileTestResult').innerHTML = '';

            try {
                // Test creating a profile
                const testProfile = {
                    uid: 'test-user-' + Date.now(),
                    email: 'test@example.com',
                    displayName: 'Test User',
                    storeName: 'Test Store ' + Date.now()
                };

                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testProfile)
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    document.getElementById('profileTestResult').innerHTML =
                        `<div class="success">‚úÖ Profile Operations: SUCCESS</div>
                         <p><strong>Action:</strong> Profile created/updated</p>
                         <p><strong>User ID:</strong> ${data.user.uid}</p>
                         <p><strong>Store Name:</strong> ${data.user.storeName}</p>
                         <p><strong>Email:</strong> ${data.user.email}</p>
                         <p><strong>Status:</strong> Database operations working correctly</p>`;
                    testResults.profile = true;
                    showStatus('Profile test passed', 'success');
                } else {
                    document.getElementById('profileTestResult').innerHTML =
                        `<div class="error">‚ùå Profile Operations: FAILED</div>
                         <p><strong>Error:</strong> ${data.error || 'Unknown error'}</p>
                         <p><strong>Details:</strong> ${data.details || 'No details available'}</p>
                         <p><strong>Solution:</strong> Check database connection and permissions.</p>`;
                    testResults.profile = false;
                    showStatus('Profile test failed', 'error');
                }
            } catch (error) {
                document.getElementById('profileTestResult').innerHTML =
                    `<div class="error">‚ùå Profile Operations: ERROR</div>
                     <p><strong>Error:</strong> ${error.message}</p>
                     <p><strong>Solution:</strong> Check server logs and database connectivity.</p>`;
                testResults.profile = false;
                showStatus('Profile test error', 'error');
            }

            updateTestSummary();
        }

        async function runFullTest() {
            showStatus('Running complete production test...', 'info');
            document.getElementById('fullTestResult').innerHTML = '';

            // Reset test results
            testResults = {
                database: false,
                auth: false,
                profile: false
            };

            // Run all tests
            await testDatabase();
            await testAuth();
            await testProfile();

            // Show final result
            const passed = Object.values(testResults).filter(Boolean).length;
            const total = Object.keys(testResults).length;

            if (passed === total) {
                document.getElementById('fullTestResult').innerHTML =
                    `<div class="success">üéâ PRODUCTION SETUP COMPLETE!</div>
                     <h3>‚úÖ All Tests Passed: ${passed}/${total}</h3>
                     <p><strong>Your app is now production-ready with:</strong></p>
                     <ul>
                         <li>‚úÖ Real PostgreSQL database (Neon)</li>
                         <li>‚úÖ Real Firebase authentication</li>
                         <li>‚úÖ Persistent user profiles</li>
                         <li>‚úÖ Production-ready architecture</li>
                     </ul>
                     <h3>üöÄ Next Steps:</h3>
                     <ol>
                         <li><strong>Test User Registration:</strong> Try registering a new account</li>
                         <li><strong>Create Store Profile:</strong> Set up your store information</li>
                         <li><strong>Test Persistence:</strong> Logout and login again</li>
                         <li><strong>Deploy:</strong> Your app is ready for production!</li>
                     </ol>
                     <div class="success">üéä Congratulations! Your production setup is working perfectly.</div>`;
                showStatus('All tests passed! Production setup complete.', 'success');
            } else {
                document.getElementById('fullTestResult').innerHTML =
                    `<div class="error">‚ùå PRODUCTION SETUP INCOMPLETE</div>
                     <h3>‚ùå Tests Failed: ${passed}/${total} Passed</h3>
                     <p><strong>Issues found:</strong></p>
                     <ul>
                         ${!testResults.database ? '<li>‚ùå Database connection failed</li>' : ''}
                         ${!testResults.auth ? '<li>‚ùå Authentication not configured</li>' : ''}
                         ${!testResults.profile ? '<li>‚ùå Profile operations failed</li>' : ''}
                     </ul>
                     <p><strong>Solution:</strong> Check the individual test results above and fix the issues.</p>
                     <button onclick="runFullTest()" class="success-button">Retry Full Test</button>`;
                showStatus('Some tests failed. Check results above.', 'error');
            }

            updateTestSummary();
        }

        // Auto-run tests on page load
        window.onload = function() {
            setTimeout(runFullTest, 1000);
        };
    </script>
</body>
</html>